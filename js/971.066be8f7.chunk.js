(self.webpackChunktowerdefensejs=self.webpackChunktowerdefensejs||[]).push([[971],{45:function(){},581:function(t,e,n){"use strict";n.d(e,{P:function(){return o},q:function(){return i}});var i=10,o=function(){function t(){}return t.logsElId="logs",t.toggleLogsButtonId="toggleLogs",t.canvasId="gameCanvas",t}()},496:function(t,e,n){"use strict";n.d(e,{M:function(){return T}});var i,o=function(){function t(t,e){void 0===e&&(e="gray"),this.points=t,this.color=e,this.percentPathMap=new Map,this.length=0,this.calculateSections()}return t.prototype.calculateSections=function(){for(var t=1;t<this.points.length;t++){var e=this.points[t],n=this.points[t-1],i=this.length;this.length+=Math.abs(n.x-e.x+(n.y-e.y)),this.percentPathMap.set({start:i,end:this.length},t)}},t.prototype.getPointAtPercent=function(t){var e=this.length/100*t,n=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),o=0;for(e=0;e<n;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,o++)i[o]=r[s];return i}(Array.from(this.percentPathMap.keys())).find((function(t){var n=t.start,i=t.end;return e>=n&&e<=i})),i=this.percentPathMap.get(n);if(!i)return null;var o=(e-n.start)/((n.end-n.start)/100)/100,r=this.points[i],s=this.points[i-1],a=r.x-s.x,h=r.y-s.y,u=s.x+a*o,c=s.y+h*o;return{x:Math.round(u),y:Math.round(c)}},t.prototype.draw=function(t){t.save(),t.fillStyle=this.color,t.beginPath(),t.setLineDash([5,15]),t.lineCap="round";for(var e=0;e<this.points.length;e++){var n=this.points[e];0===e?t.moveTo(n.x,n.y):t.lineTo(n.x,n.y)}t.stroke(),t.restore(),this.drawStartEnd(t)},t.prototype.drawStartEnd=function(t){t.beginPath(),t.fillStyle="orange",t.arc(this.points[0].x,this.points[0].y,10,0,360),t.arc(this.points[this.points.length-1].x,this.points[this.points.length-1].y,10,0,360),t.fill(),t.closePath()},t}();!function(t){t.SpearTower="SpearTower",t.SplashTower="SplashTower"}(i||(i={}));var r,s=function(){function t(){}return t.pointInsideRect=function(t,e,n){var i=t.x>=e.x-n.width/2&&t.x<=e.x+n.width/2,o=t.y>=e.y-n.width/2&&t.y<=e.y+n.width/2;return i&&o},t.pointInsideCircle=function(t,e,n){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))<n},t}(),a=n(581),h=(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},r(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),u=function(){function t(t,e,n){void 0===e&&(e=a.q),void 0===n&&(n="black"),this.position=t,this.blockSize=e,this.color=n}return Object.defineProperty(t.prototype,"x",{get:function(){return this.position.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.position.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftTopX",{get:function(){return this.position.x-this.blockSize/2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftTopY",{get:function(){return this.position.y-this.blockSize/2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftTop",{get:function(){return{x:this.leftTopX,y:this.leftTopY}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.blockSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.blockSize},enumerable:!0,configurable:!0}),t.prototype.moveTo=function(t){this.position=t},t.prototype.draw=function(t,e){throw void 0===e&&(e=this.color),new Error("not implemented")},t}(),c=function(){function t(){}return t.createTower=function(t,e,n){if(e===i.SpearTower){var o=function(t,e){switch(t){case i.SpearTower:return{damageStart:45,damageEnd:65,attackRange:100,attackSpeed:5};case i.SplashTower:return{damageStart:20,damageEnd:40,attackRange:50,attackSpeed:2}}}(e);return new p(t,o)}},t}(),p=function(t){function e(e,n,i,o){void 0===i&&(i=a.q),void 0===o&&(o="blue");var r=t.call(this,e,i,o)||this;r.damageStart=45,r.damageEnd=65,r.attackRange=100,r.attackSpeed=5,r.attackCounter=100;var s=n.attackRange,h=n.attackSpeed,u=n.damageEnd,c=n.damageStart;return r.damageStart=c,r.damageEnd=u,r.attackRange=s,r.attackSpeed=h,r}return h(e,t),Object.defineProperty(e.prototype,"damage",{get:function(){return t=this.damageStart,e=this.damageEnd,Math.random()*(e-t)+t;var t,e},enumerable:!0,configurable:!0}),e.prototype.onClickHandler=function(t,e){},e.prototype.pointInPath=function(t,e){return t.isPointInPath(this.path,e.x,e.y)},e.prototype.draw=function(t,e){void 0===e&&(e=this.color),t.save(),t.beginPath(),t.fillStyle=e,this.path=new Path2D,this.path.arc(this.leftTopX,this.leftTopY,this.width,0,360),t.fill(this.path),t.closePath(),this.drawAttackRange(t),t.restore()},e.prototype.drawAttackRange=function(t){t.beginPath(),t.setLineDash([5,15]),t.fillStyle="gray",t.arc(this.leftTopX,this.leftTopY,this.attackRange,0,360),t.stroke(),t.closePath()},e.prototype.attack=function(t){if(this.attackCounter<=100)this.attackCounter+=this.attackSpeed;else{for(var e=0;e<t.length;e++){var n=t[e];if(!n.dead&&s.pointInsideCircle(n,this.position,this.attackRange))return n.shootAt(this.damage,this.position),void(this.attackCounter=0)}this.attackCounter=0}},e}(u),l=document.getElementById(a.P.logsElId),f=function(){function t(t){var e=this;this.htmlCanvas=t,this.emptyColor="white",this.items=[],this._dragNDropDisabled=!1,t.addEventListener("mousedown",(function(t){return e.handleMousedown(t)})),t.addEventListener("touchstart",(function(t){return e.handleTouchstart(t)})),t.addEventListener("mousemove",(function(t){return e.handleMousemove(t)})),t.addEventListener("touchmove",(function(t){return e.handleTouchmove(t)})),t.addEventListener("mouseup",(function(t){return e.handleMouseup(t)})),t.addEventListener("touchend",(function(t){return e.handleTouchend(t)})),t.addEventListener("click",(function(t){return e.handleMouseClicks(t)})),this.setSize({height:400,width:600})}return t.prototype.DisableDragNDrop=function(){this._dragNDropDisabled=!0},t.prototype.EnabledDragNDrop=function(){this._dragNDropDisabled=!1},t.prototype.handleMousedown=function(t){var e=this,n={x:t.offsetX,y:t.offsetY};this.dragItem=this._dragNDropDisabled?void 0:this.items.filter((function(t){return t.pointInPath})).find((function(t){return t.pointInPath(e.ctx,n)}))},t.prototype.handleTouchstart=function(t){var e,n=this,i=t.touches.length&&t.touches[0],o={x:i.pageX-this.htmlCanvas.offsetLeft,y:i.pageY-this.htmlCanvas.offsetTop};e="handleTouchstart: "+JSON.stringify(o),l&&(l.innerHTML=e+"\n"+l.innerHTML),this.handleOnClick(o),this.dragItem=this.items.filter((function(t){return t.pointInPath})).find((function(t){return t.pointInPath(n.ctx,o)}))},t.prototype.handleMousemove=function(t){var e={x:t.offsetX,y:t.offsetY};this.dragItem&&(this.dragItem.moveTo(e),this.update())},t.prototype.handleTouchmove=function(t){var e=t.touches.length&&t.touches[0],n={x:e.pageX-this.htmlCanvas.offsetLeft,y:e.pageY-this.htmlCanvas.offsetTop};this.dragItem&&(this.dragItem.moveTo(n),this.update())},t.prototype.handleMouseup=function(t){this.dragItem=void 0},t.prototype.handleTouchend=function(t){this.dragItem=void 0},t.prototype.handleMouseClicks=function(t){this.handleOnClick({x:t.offsetX,y:t.offsetY})},t.prototype.setSize=function(t){var e=void 0===t?{width:window.innerWidth,height:window.innerHeight}:t,n=e.width,i=e.height;this.htmlCanvas.width=n,this.htmlCanvas.height=i},Object.defineProperty(t.prototype,"size",{get:function(){return{height:this.htmlCanvas.height,width:this.htmlCanvas.width}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ctx",{get:function(){return this.htmlCanvas.getContext("2d")},enumerable:!0,configurable:!0}),t.prototype.add=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];(t=this.items).push.apply(t,e)},t.prototype.remove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.items=this.items.filter((function(e){return!t.includes(e)}))},t.prototype.update=function(){this.ctx.fillStyle=this.emptyColor,this.ctx.clearRect(0,0,this.size.width,this.size.height);for(var t=0;t<this.items.length;t++)this.items[t].draw(this.ctx)},t.prototype.handleOnClick=function(t){var e=this;this.items.filter((function(t){return t.onClickHandler})).forEach((function(n){return n.onClickHandler(e.ctx,t)}))},t}(),d=function(){function t(t){this.canvasSize=t,this.barHeight=100}return t.prototype.draw=function(t,e){t.fillStyle="green",t.fillRect(0,0,this.canvasSize.width,this.barHeight),this.drawMenuItems()},t.prototype.drawMenuItems=function(){},t}(),v=function(){function t(t,e,n){void 0===n&&(n={buttonHeight:50,buttonWidth:100,leftTopX:1,leftTopY:2}),this.text=t,this.onClick=e,this.params=n}return t.prototype.pointInPath=function(t,e){return t.isPointInPath(this.path,e.x,e.y)},t.prototype.onClickHandler=function(t,e){this.pointInPath(t,e)&&this.onClick&&this.onClick()},t.prototype.draw=function(t,e){void 0===e&&(e="#A9B665");var n=t.createRadialGradient(this.params.leftTopX+45,this.params.leftTopY+45,10,this.params.leftTopX+52,this.params.leftTopY+50,100);n.addColorStop(0,"#A7D30C"),n.addColorStop(1,"#019F62"),t.fillStyle=n,this.path=new Path2D,this.path.rect(this.params.leftTopX,this.params.leftTopY,this.params.buttonWidth,this.params.buttonHeight),t.fill(this.path),t.font="20px Arial",t.textAlign="center",t.textBaseline="middle",t.fillStyle="black",t.fillText(this.text,this.params.leftTopX+this.params.buttonWidth/2,this.params.leftTopY+this.params.buttonHeight/2)},t}(),g=function(){function t(t,e,n){this.dmg=t,this.position=e,this.target=n,this.progress=0,this.speed=.3}return t.prototype.draw=function(t,e){void 0===e&&(e="green"),t.beginPath(),t.fillStyle=e,t.arc(this.position.x,this.position.y,2,0,360),t.fill(),t.closePath()},t.prototype.moveForward=function(){var t=this.target.position,e=t.x-this.position.x,n=t.y-this.position.y,i=this.position.x+e*this.progress,o=this.position.y+n*this.progress;return this.position={x:Math.round(i),y:Math.round(o)},this.progress+=this.speed,this.progress>=1},t}(),y=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),m=function(t){function e(e,n,i,o){void 0===n&&(n=.3),void 0===i&&(i=a.q),void 0===o&&(o="red");var r=t.call(this,e.points[0],i,o)||this;return r.path=e,r.moveSpeed=n,r.progress=0,r._dead=!1,r._healthPoints=100,r.projectiles=[],r}return y(e,t),Object.defineProperty(e.prototype,"dead",{get:function(){return this._dead},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hp",{get:function(){return this._healthPoints},enumerable:!0,configurable:!0}),e.prototype.shootAt=function(t,e){this.projectiles.push(new g(t,e,this))},e.prototype.doDamage=function(t){this._healthPoints-=t,this._healthPoints<=0&&(this._dead=!0)},e.prototype.draw=function(t,e){void 0===e&&(e=this.color),this.dead?t.fillStyle="gray":t.fillStyle=e;var n=new Path2D;n.rect(this.leftTopX,this.leftTopY,this.width,this.height),t.fill(n),this.projectiles.forEach((function(e){return e.draw(t)}))},e.prototype.moveForward=function(){var t=this,e=this.projectiles.filter((function(t){return t.moveForward()}));if(e.length>0&&(e.forEach((function(e){return t.doDamage(e.dmg)})),this.projectiles=this.projectiles.filter((function(t){return!e.includes(t)}))),this.dead)return!1;var n=this.path.getPointAtPercent(this.progress);return n?(this.moveTo(n),this.progress>=100||(this.progress+this.moveSpeed>100?(this.progress=100,!0):(this.progress+=this.moveSpeed,!1))):void 0},e}(u),w=function(){return w=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},w.apply(this,arguments)},b=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function s(t){try{h(i.next(t))}catch(t){r(t)}}function a(t){try{h(i.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}h((i=i.apply(t,e||[])).next())}))},S=function(t,e){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},x=new o([{x:10,y:10},{x:10,y:300},{x:200,y:300},{x:300,y:10},{x:500,y:10},{x:500,y:300}]),P=[c.createTower({x:50,y:50},i.SpearTower,1),c.createTower({x:100,y:250},i.SpearTower,1)],T=function(){function t(t){this.htmlCanvas=t,this.towers=P,this.path=x,this.enemies=[],this.fps=60,this.lifes=7,this.waves=new Map([[1,{enemiesColor:"blue",enemiesMoveSpeed:1,enemiesNumber:3,spawnSpeed:500}],[2,{enemiesColor:"red",enemiesMoveSpeed:.1,enemiesNumber:20,spawnSpeed:500}],[3,{enemiesColor:"green",enemiesMoveSpeed:.5,enemiesNumber:10,spawnSpeed:100}],[4,{enemiesColor:"brown",enemiesMoveSpeed:.5,enemiesNumber:200,spawnSpeed:300}]]),this.gameIsRunning=!1,this.canvas=new f(t),this.bottomRightButton={buttonHeight:50,buttonWidth:100,leftTopX:this.canvas.size.width-100,leftTopY:this.canvas.size.height-50}}return t.prototype.testMode=function(){var t=new d(this.canvas.size);this.canvas.add(t),this.canvas.update()},t.prototype.initialize=function(){var t;this.lifes=7,this.canvas=new f(this.htmlCanvas),this.enemies=[],(t=this.canvas).add.apply(t,function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),o=0;for(e=0;e<n;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,o++)i[o]=r[s];return i}(this.towers,[this.path])),this.showMainMenu()},t.prototype.showMainMenu=function(){var t=this,e=new v("Start",(function(){t.canvas.remove(e),t.canvas.update(),t.start()}),this.bottomRightButton);this.canvas.add(e),this.canvas.update()},t.prototype.start=function(){var t=this;this.intervalId=setInterval((function(){t.run()}),1e3/this.fps),this.gameIsRunning=!0,this.startLevel(1)},t.prototype.startLevel=function(t){return b(this,void 0,void 0,(function(){var e,n,i=this;return S(this,(function(o){switch(o.label){case 0:return this.gameIsRunning?[4,this.startEnemiesSpawn(t)]:[3,2];case 1:o.sent()&&this.gameIsRunning&&(t<this.waves.size?(e=new v("Start level: "+ ++t,(function(){i.canvas.remove(e),i.startLevel(t)}),w(w({},this.bottomRightButton),{buttonWidth:150,leftTopX:this.canvas.size.width-150})),this.canvas.add(e)):(n=new v("You won!",(function(){i.canvas.remove(n),i.initialize()}),this.bottomRightButton),this.canvas.add(n))),o.label=2;case 2:return[2]}}))}))},t.prototype.startEnemiesSpawn=function(t){return b(this,void 0,void 0,(function(){var e,n,i,o=this;return S(this,(function(r){return console.log("level: ",t),e=1,n=this.waves.get(t),(i=function(){var t=new m(o.path,n.enemiesMoveSpeed,void 0,n.enemiesColor);o.enemies.push(t),o.canvas.add(t)})(),[2,new Promise((function(t,r){var s=setInterval((function(){if(e>=n.enemiesNumber)return s&&clearInterval(s),void t(!0);i(),e++,o.gameIsRunning||(s&&clearInterval(s),t(!1))}),n.spawnSpeed)}))]}))}))},t.prototype.run=function(){var t=this;this.enemies.forEach((function(e){if(e.moveForward()&&(t.lifes--,t.enemies=t.enemies.filter((function(t){return t!==e})),console.log("lifes: ",t.lifes),t.lifes<=0)){t.stop();var n=new v("Game over",(function(){t.canvas.remove(n),t.initialize()}),t.bottomRightButton);t.canvas.add(n)}})),this.towers.forEach((function(e){return e.attack(t.enemies)})),this.canvas.update()},t.prototype.stop=function(){this.intervalId&&clearInterval(this.intervalId),this.gameIsRunning=!1},t}()}}]);
//# sourceMappingURL=971.066be8f7.chunk.js.map