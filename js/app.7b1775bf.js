!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=1)}([function(t,e,s){},function(t,e,s){"use strict";s.r(e);var i;s(0);!function(t){t.SpearTower="SpearTower",t.SplashTower="SplashTower"}(i||(i={}));class n{static pointInsideRect(t,e,s){const i=t.x>=e.x-s.width/2&&t.x<=e.x+s.width/2,n=t.y>=e.y-s.width/2&&t.y<=e.y+s.width/2;return i&&n}static pointInsideCircle(t,e,s){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))<s}}class a{}a.logsElId="logs",a.toggleLogsButtonId="toggleLogs",a.canvasId="gameCanvas";class h{constructor(t,e=10,s="black"){this.position=t,this.blockSize=e,this.color=s}get x(){return this.position.x}get y(){return this.position.y}get leftTopX(){return this.position.x-this.blockSize/2}get leftTopY(){return this.position.y-this.blockSize/2}get leftTop(){return{x:this.leftTopX,y:this.leftTopY}}get width(){return this.blockSize}get height(){return this.blockSize}moveTo(t){this.position=t}draw(t,e=this.color){throw new Error("not implemented")}}class o{static createTower(t,e,s){switch(e){case i.SpearTower:const s=((t,e)=>{switch(t){case i.SpearTower:return{damageStart:45,damageEnd:65,attackRange:100,attackSpeed:5};case i.SplashTower:return{damageStart:20,damageEnd:40,attackRange:50,attackSpeed:2}}})(e);return new r(t,s)}}}class r extends h{constructor(t,e,s=10,i="blue"){super(t,s,i),this.damageStart=45,this.damageEnd=65,this.attackRange=100,this.attackSpeed=5,this.attackCounter=100;const{attackRange:n,attackSpeed:a,damageEnd:h,damageStart:o}=e;this.damageStart=o,this.damageEnd=h,this.attackRange=n,this.attackSpeed=a}get damage(){return t=this.damageStart,e=this.damageEnd,Math.random()*(e-t)+t;var t,e}onClickHandler(t,e){}pointInPath(t,e){return t.isPointInPath(this.path,e.x,e.y)}draw(t,e=this.color){t.save(),t.beginPath(),t.fillStyle=e,this.path=new Path2D,this.path.arc(this.leftTopX,this.leftTopY,this.width,0,360),t.fill(this.path),t.closePath(),this.drawAttackRange(t),t.restore()}drawAttackRange(t){t.beginPath(),t.setLineDash([5,15]),t.fillStyle="gray",t.arc(this.leftTopX,this.leftTopY,this.attackRange,0,360),t.stroke(),t.closePath()}attack(t){if(this.attackCounter<=100)this.attackCounter+=this.attackSpeed;else{for(let e=0;e<t.length;e++){const s=t[e];if(!s.dead&&n.pointInsideCircle(s,this.position,this.attackRange))return s.shootAt(this.damage,this.position),void(this.attackCounter=0)}this.attackCounter=0}}}const l=document.getElementById(a.logsElId);class d{constructor(t){this.htmlCanvas=t,this.emptyColor="white",this.items=[],this._dragNDropDisabled=!1,t.addEventListener("mousedown",t=>this.handleMousedown(t)),t.addEventListener("touchstart",t=>this.handleTouchstart(t)),t.addEventListener("mousemove",t=>this.handleMousemove(t)),t.addEventListener("touchmove",t=>this.handleTouchmove(t)),t.addEventListener("mouseup",t=>this.handleMouseup(t)),t.addEventListener("touchend",t=>this.handleTouchend(t)),t.addEventListener("click",t=>this.handleMouseClicks(t)),this.setSize({height:400,width:600})}DisableDragNDrop(){this._dragNDropDisabled=!0}EnabledDragNDrop(){this._dragNDropDisabled=!1}handleMousedown(t){const e={x:t.offsetX,y:t.offsetY};this.dragItem=this._dragNDropDisabled?void 0:this.items.filter(t=>t.pointInPath).find(t=>t.pointInPath(this.ctx,e))}handleTouchstart(t){const e=t.touches.length&&t.touches[0],s={x:e.pageX-this.htmlCanvas.offsetLeft,y:e.pageY-this.htmlCanvas.offsetTop};var i;i="handleTouchstart: "+JSON.stringify(s),l&&(l.innerHTML=i+"\n"+l.innerHTML),this.handleOnClick(s),this.dragItem=this.items.filter(t=>t.pointInPath).find(t=>t.pointInPath(this.ctx,s))}handleMousemove(t){const e={x:t.offsetX,y:t.offsetY};this.dragItem&&(this.dragItem.moveTo(e),this.update())}handleTouchmove(t){const e=t.touches.length&&t.touches[0],s={x:e.pageX-this.htmlCanvas.offsetLeft,y:e.pageY-this.htmlCanvas.offsetTop};this.dragItem&&(this.dragItem.moveTo(s),this.update())}handleMouseup(t){this.dragItem=void 0}handleTouchend(t){this.dragItem=void 0}handleMouseClicks(t){this.handleOnClick({x:t.offsetX,y:t.offsetY})}setSize({width:t,height:e}={width:window.innerWidth,height:window.innerHeight}){this.htmlCanvas.width=t,this.htmlCanvas.height=e}get size(){return{height:this.htmlCanvas.height,width:this.htmlCanvas.width}}get ctx(){return this.htmlCanvas.getContext("2d")}add(...t){this.items.push(...t)}remove(...t){this.items=this.items.filter(e=>!t.includes(e))}update(){this.ctx.fillStyle=this.emptyColor,this.ctx.clearRect(0,0,this.size.width,this.size.height);for(let t=0;t<this.items.length;t++){this.items[t].draw(this.ctx)}}handleOnClick(t){this.items.filter(t=>t.onClickHandler).forEach(e=>e.onClickHandler(this.ctx,t))}}class c{constructor(t){this.canvasSize=t,this.barHeight=100}draw(t,e){t.fillStyle="green",t.fillRect(0,0,this.canvasSize.width,this.barHeight),this.drawMenuItems()}drawMenuItems(){}}class p{constructor(t,e,s={buttonHeight:50,buttonWidth:100,leftTopX:1,leftTopY:2}){this.text=t,this.onClick=e,this.params=s}pointInPath(t,e){return t.isPointInPath(this.path,e.x,e.y)}onClickHandler(t,e){this.pointInPath(t,e)&&this.onClick&&this.onClick()}draw(t,e="#A9B665"){const s=t.createRadialGradient(this.params.leftTopX+45,this.params.leftTopY+45,10,this.params.leftTopX+52,this.params.leftTopY+50,100);s.addColorStop(0,"#A7D30C"),s.addColorStop(1,"#019F62"),t.fillStyle=s,this.path=new Path2D,this.path.rect(this.params.leftTopX,this.params.leftTopY,this.params.buttonWidth,this.params.buttonHeight),t.fill(this.path),t.font="20px Arial",t.textAlign="center",t.textBaseline="middle",t.fillStyle="black",t.fillText(this.text,this.params.leftTopX+this.params.buttonWidth/2,this.params.leftTopY+this.params.buttonHeight/2)}}class u{constructor(t,e,s){this.dmg=t,this.position=e,this.target=s,this.progress=0,this.speed=.3}draw(t,e="green"){t.beginPath(),t.fillStyle=e,t.arc(this.position.x,this.position.y,2,0,360),t.fill(),t.closePath()}moveForward(){const t=this.target.position;var e=t.x-this.position.x,s=t.y-this.position.y,i=this.position.x+e*this.progress,n=this.position.y+s*this.progress;return this.position={x:Math.round(i),y:Math.round(n)},this.progress+=this.speed,this.progress>=1}}class g extends h{constructor(t,e=.3,s=10,i="red"){super(t.points[0],s,i),this.path=t,this.moveSpeed=e,this.progress=0,this._dead=!1,this._healthPoints=100,this.projectiles=[]}get dead(){return this._dead}get hp(){return this._healthPoints}shootAt(t,e){this.projectiles.push(new u(t,e,this))}doDamage(t){this._healthPoints-=t,this._healthPoints<=0&&(this._dead=!0)}draw(t,e=this.color){this.dead?t.fillStyle="gray":t.fillStyle=e;const s=new Path2D;s.rect(this.leftTopX,this.leftTopY,this.width,this.height),t.fill(s),this.projectiles.forEach(e=>e.draw(t))}moveForward(){const t=this.projectiles.filter(t=>t.moveForward());if(t.length>0&&(t.forEach(t=>this.doDamage(t.dmg)),this.projectiles=this.projectiles.filter(e=>!t.includes(e))),this.dead)return!1;const e=this.path.getPointAtPercent(this.progress);return e?(this.moveTo(e),this.progress>=100||(this.progress+this.moveSpeed>100?(this.progress=100,!0):(this.progress+=this.moveSpeed,!1))):void 0}}var m=function(t,e,s,i){return new(s||(s=Promise))((function(n,a){function h(t){try{r(i.next(t))}catch(t){a(t)}}function o(t){try{r(i.throw(t))}catch(t){a(t)}}function r(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(h,o)}r((i=i.apply(t,e||[])).next())}))};const f=new class{constructor(t,e="gray"){this.points=t,this.color=e,this.percentPathMap=new Map,this.length=0,this.calculateSections()}calculateSections(){for(let t=1;t<this.points.length;t++){const e=this.points[t],s=this.points[t-1],i=this.length;this.length+=Math.abs(s.x-e.x+(s.y-e.y)),this.percentPathMap.set({start:i,end:this.length},t)}}getPointAtPercent(t){const e=this.length/100*t,s=[...this.percentPathMap.keys()].find(({start:t,end:s})=>e>=t&&e<=s),i=this.percentPathMap.get(s);if(!i)return null;const n=(e-s.start)/((s.end-s.start)/100)/100,a=this.points[i],h=this.points[i-1];var o=a.x-h.x,r=a.y-h.y,l=h.x+o*n,d=h.y+r*n;return{x:Math.round(l),y:Math.round(d)}}draw(t){t.save(),t.fillStyle=this.color,t.beginPath(),t.setLineDash([5,15]),t.lineCap="round";for(let e=0;e<this.points.length;e++){const s=this.points[e];0===e?t.moveTo(s.x,s.y):t.lineTo(s.x,s.y)}t.stroke(),t.restore(),this.drawStartEnd(t)}drawStartEnd(t){t.beginPath(),t.fillStyle="orange",t.arc(this.points[0].x,this.points[0].y,10,0,360),t.arc(this.points[this.points.length-1].x,this.points[this.points.length-1].y,10,0,360),t.fill(),t.closePath()}}([{x:10,y:10},{x:10,y:300},{x:200,y:300},{x:300,y:10},{x:500,y:10},{x:500,y:300}]),v=[o.createTower({x:50,y:50},i.SpearTower,1),o.createTower({x:100,y:250},i.SpearTower,1)];const w=document.getElementById(a.canvasId);new class{constructor(t){this.htmlCanvas=t,this.towers=v,this.path=f,this.enemies=[],this.fps=60,this.lifes=7,this.waves=new Map([[1,{enemiesColor:"blue",enemiesMoveSpeed:1,enemiesNumber:3,spawnSpeed:500}],[2,{enemiesColor:"red",enemiesMoveSpeed:.1,enemiesNumber:20,spawnSpeed:500}],[3,{enemiesColor:"green",enemiesMoveSpeed:.5,enemiesNumber:10,spawnSpeed:100}],[4,{enemiesColor:"brown",enemiesMoveSpeed:.5,enemiesNumber:200,spawnSpeed:300}]]),this.gameIsRunning=!1,this.canvas=new d(t),this.bottomRightButton={buttonHeight:50,buttonWidth:100,leftTopX:this.canvas.size.width-100,leftTopY:this.canvas.size.height-50}}testMode(){const t=new c(this.canvas.size);this.canvas.add(t),this.canvas.update()}initialize(){this.lifes=7,this.canvas=new d(this.htmlCanvas),this.enemies=[],this.canvas.add(...this.towers,this.path),this.showMainMenu()}showMainMenu(){const t=new p("Start",()=>{this.canvas.remove(t),this.canvas.update(),this.start()},this.bottomRightButton);this.canvas.add(t),this.canvas.update()}start(){this.intervalId=setInterval(()=>{this.run()},1e3/this.fps),this.gameIsRunning=!0,this.startLevel(1)}startLevel(t){return m(this,void 0,void 0,(function*(){if(this.gameIsRunning){if((yield this.startEnemiesSpawn(t))&&this.gameIsRunning)if(t<this.waves.size){const e=new p("Start level: "+ ++t,()=>{this.canvas.remove(e),this.startLevel(t)},Object.assign(Object.assign({},this.bottomRightButton),{buttonWidth:150,leftTopX:this.canvas.size.width-150}));this.canvas.add(e)}else{const t=new p("You won!",()=>{this.canvas.remove(t),this.initialize()},this.bottomRightButton);this.canvas.add(t)}}}))}startEnemiesSpawn(t){return m(this,void 0,void 0,(function*(){console.log("level: ",t);let e=1;const s=this.waves.get(t),i=()=>{const t=new g(this.path,s.enemiesMoveSpeed,void 0,s.enemiesColor);this.enemies.push(t),this.canvas.add(t)};return i(),new Promise((t,n)=>{const a=setInterval(()=>{if(e>=s.enemiesNumber)return a&&clearInterval(a),void t(!0);i(),e++,this.gameIsRunning||(a&&clearInterval(a),t(!1))},s.spawnSpeed)})}))}run(){this.enemies.forEach(t=>{if(t.moveForward()&&(this.lifes--,this.enemies=this.enemies.filter(e=>e!==t),console.log("lifes: ",this.lifes),this.lifes<=0)){this.stop();const t=new p("Game over",()=>{this.canvas.remove(t),this.initialize()},this.bottomRightButton);this.canvas.add(t)}}),this.towers.forEach(t=>t.attack(this.enemies)),this.canvas.update()}stop(){this.intervalId&&clearInterval(this.intervalId),this.gameIsRunning=!1}}(w).initialize();const y=document.getElementById(a.toggleLogsButtonId);null==y||y.addEventListener("click",()=>{document.getElementById(a.logsElId).toggleAttribute("hidden")})}]);
//# sourceMappingURL=app.7b1775bf.js.map